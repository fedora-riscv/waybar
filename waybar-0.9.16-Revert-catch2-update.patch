From a821179ed6fce1e45f65821571d54a392da7c4a0 Mon Sep 17 00:00:00 2001
From: Aleksei Bavshin <alebastr@fedoraproject.org>
Date: Thu, 24 Nov 2022 21:14:59 -0800
Subject: [PATCH] Revert catch2 update

---
 meson.build             |  1 -
 subprojects/catch2.wrap | 17 ++++++++---------
 test/SafeSignal.cpp     |  2 +-
 test/config.cpp         |  2 +-
 test/main.cpp           | 19 +++++++++----------
 test/waybar_time.cpp    |  2 +-
 6 files changed, 20 insertions(+), 23 deletions(-)

diff --git a/meson.build b/meson.build
index 557a02d..e6b1670 100644
--- a/meson.build
+++ b/meson.build
@@ -435,7 +435,7 @@ endif
 
 catch2 = dependency(
     'catch2',
-    version: '>=3.0.0',
+    version: ['>=2.13.0', '<3.0.0'],
     fallback: ['catch2', 'catch2_dep'],
     required: get_option('tests'),
 )
diff --git a/test/SafeSignal.cpp b/test/SafeSignal.cpp
index 7ff6f2a..6a1e17a 100644
--- a/test/SafeSignal.cpp
+++ b/test/SafeSignal.cpp
@@ -2,7 +2,7 @@
 
 #include <glibmm.h>
 
-#include <catch2/catch_all.hpp>
+#include <catch2/catch.hpp>
 #include <thread>
 #include <type_traits>
 
diff --git a/test/config.cpp b/test/config.cpp
index cdc96b0..29b0502 100644
--- a/test/config.cpp
+++ b/test/config.cpp
@@ -1,6 +1,6 @@
 #include "config.hpp"
 
-#include <catch2/catch_all.hpp>
+#include <catch2/catch.hpp>
 
 TEST_CASE("Load simple config", "[config]") {
   waybar::Config conf;
diff --git a/test/main.cpp b/test/main.cpp
index 7970c26..5eb060d 100644
--- a/test/main.cpp
+++ b/test/main.cpp
@@ -3,8 +3,8 @@
 #include <spdlog/sinks/stdout_sinks.h>
 #include <spdlog/spdlog.h>
 
-#include <catch2/catch_all.hpp>
-#include <catch2/reporters/catch_reporter_tap.hpp>
+#include <catch2/catch.hpp>
+#include <catch2/catch_reporter_tap.hpp>
 #include <memory>
 
 int main(int argc, char* argv[]) {
@@ -13,14 +13,13 @@ int main(int argc, char* argv[]) {
 
   session.applyCommandLine(argc, argv);
   const auto logger = spdlog::default_logger();
-  for (const auto& spec : session.config().getReporterSpecs()) {
-    if (spec.name() == "tap") {
-      spdlog::set_pattern("# [%l] %v");
-    } else if (spec.name() == "compact") {
-      logger->sinks().clear();
-    } else {
-      logger->sinks().assign({std::make_shared<spdlog::sinks::stderr_sink_st>()});
-    }
+  const auto& reporter_name = session.config().getReporterName();
+  if (reporter_name == "tap") {
+    spdlog::set_pattern("# [%l] %v");
+  } else if (reporter_name == "compact") {
+    logger->sinks().clear();
+  } else {
+    logger->sinks().assign({std::make_shared<spdlog::sinks::stderr_sink_st>()});
   }
 
   return session.run();
diff --git a/test/waybar_time.cpp b/test/waybar_time.cpp
index 79469d4..5fc3312 100644
--- a/test/waybar_time.cpp
+++ b/test/waybar_time.cpp
@@ -3,7 +3,7 @@
 #include <date/date.h>
 #include <date/tz.h>
 
-#include <catch2/catch_all.hpp>
+#include <catch2/catch.hpp>
 #include <chrono>
 #include <stdexcept>
 
-- 
2.38.1

