From 2c3c236f69d1a11903589b3824a2c103982a7644 Mon Sep 17 00:00:00 2001
From: Aleksei Bavshin <alebastr@fedoraproject.org>
Date: Tue, 5 Jan 2021 01:47:15 -0800
Subject: [PATCH] Relax spdlog requirement to the version available in f32.

This patch is required for modular build to succeed.
---
 meson.build | 2 +-
 src/bar.cpp | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/meson.build b/meson.build
index 839c1dc..bd9420c 100644
--- a/meson.build
+++ b/meson.build
@@ -80,7 +80,7 @@ is_openbsd = host_machine.system() == 'openbsd'
 
 thread_dep = dependency('threads')
 fmt = dependency('fmt', version : ['>=5.3.0'], fallback : ['fmt', 'fmt_dep'])
-spdlog = dependency('spdlog', version : ['>=1.8.0'], fallback : ['spdlog', 'spdlog_dep'], default_options : ['external_fmt=true'])
+spdlog = dependency('spdlog', version : ['>=1.5.0'], fallback : ['spdlog', 'spdlog_dep'], default_options : ['external_fmt=true'])
 wayland_client = dependency('wayland-client')
 wayland_cursor = dependency('wayland-cursor')
 wayland_protos = dependency('wayland-protocols')
diff --git a/src/bar.cpp b/src/bar.cpp
index 7bd6172..ec1d0de 100644
--- a/src/bar.cpp
+++ b/src/bar.cpp
@@ -461,7 +461,7 @@ waybar::Bar::Bar(struct waybar_output* w_output, const Json::Value& w_config)
   setupWidgets();
   window.show_all();
 
-  if (spdlog::should_log(spdlog::level::debug)) {
+  if (spdlog::default_logger_raw()->level() >= spdlog::level::debug) {
     // Unfortunately, this function isn't in the C++ bindings, so we have to call the C version.
     char* gtk_tree = gtk_style_context_to_string(
         window.get_style_context()->gobj(),
-- 
2.29.2

